---
title: "work"
author: "Yaswanth"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

# Title Info 

# Introduction

# Libraries 

```{r}
library(tidyverse)
library(dplyr)
library(funModeling)
library(ezids)
library(ggplot2)
library(ggcorrplot)
library(corrr)
```


# Load the Data and Rename dataframe 
```{r}

 heart<-read.csv("heart_2020_cleaned.csv")

```
# Lets take a look at our data
```{r}
nrow (heart)
```


# Descrpitive Statistics  
```{r}
status (heart)
```

From the table we can see that Physical and Mental health have a higher percentage of zeros. This means that just over 70% of the people in our data set are not physically active while about 60% of the respondents do not report having mental health issues. 

We can also see that there are no N/A values in our data set. This is not surprising because our source data was cleaned before. 

# Now to see which variables are categorical and which are numerical 
```{r}
data_integrity(heart)
```
# Description of every variable 
```{r error= TRUE}
describe (heart)
```

Converting HeartDIsease categorical into Numerical Variable

```{r}
heart$HD<-ifelse(heart$HeartDisease=="Yes",1,0)
```
# Finding the mean of numerical variables grouped by Gen Health
```{r }
#plot_num(heart)
heart$GenHealth<-as.factor(heart$GenHealth)
heart$GeneralHealth<-sapply(heart$GenHealth,unclass)
heart %>%
  group_by(HeartDisease) %>%
  summarise_at(vars("GeneralHealth"), mean)
```

There is very less differnce in General Health, Even people are healthy (normal GeneralHealth) people have No heartDisease by 3.22 times than people wih people with non general health get by 3.12 
# Frequency distributions of all our categorical variables 
```{r}
freq(heart)
```


# Changing Diabetes bordeline and pregnancy categories to Yes/No
```{r}
heart$Diabetic<- replace (heart$Diabetic, heart$Diabetic== "No, borderline diabetes" , "Yes")
heart$Diabetic[heart$Diabetic== "Yes (during pregnancy)"] <- "No"  
```


#Checking if diabetic has been changed 
```{r}
describe (heart$Diabetic)
freq(heart$Diabetic)
```

# Changing all the categorical variables to numerical dummies 
```{r}

heart$Smoking<-ifelse(heart$Smoking=="Yes",1,0)
heart$AlcoholDrinking<-ifelse(heart$AlcoholDrinking=="Yes",1,0)
heart$Stroke<-ifelse(heart$Stroke=="Yes",1,0)
heart$DiffWalking<-ifelse(heart$DiffWalking=="Yes",1,0)
heart$PhysicalActivity<-ifelse(heart$PhysicalActivity=="Yes",1,0)
heart$KidneyDisease<-ifelse(heart$KidneyDisease=="Yes",1,0)
heart$SkinCancer<-ifelse(heart$SkinCancer=="Yes",1,0)
heart$Diabetic<-ifelse(heart$Diabetic=="Yes",1,0)
heart$Asthma<-ifelse(heart$Asthma=="Yes",1,0)
```

# Changing race variable to numerical variable
```{r}
heart$Race<-as.factor(heart$Race)
heart$Ethnicity<-sapply(heart$Race,unclass)
```


# Converting white as 6, Hispanic as 5,Black as 4, Other as 3, Asian as 2, American Indian as 1

```{r}

 model.matrix(~0+., data=heart) %>% 
     cor(use="pairwise.complete.obs") %>% 
   ggcorrplot(show.diag = F, type="upper", lab=TRUE, lab_size=2)
```



```{r}

contable = table(heart$GeneralHealth, heart$Ethnicity)
xkabledply(contable, title="Contingency Table for heart Disease and Sex")
addmargins(contable)

prop <-prop.table(contable)
percent <- round(prop*100, 2)

print ("Contingency Table for heart Disease and Sex in Percentage")
print (percent)
barplot(with(heart, table(GeneralHealth, Ethnicity)), main="heart Disease & Sex", beside=T, col=3:2)
```

```{r}
boxplot(HD~GeneralHealth,data=heart)
```

```{r}
boxplot(Ethnicity~HD,data=heart)
```

```{r}

t.test(heart$GeneralHealth, heart$HD)
t.test(heart$GeneralHealth, heart$Ethnicity)
```

```{r}
Genh_HD=table(heart$GeneralHealth,heart$HD)
chi_1=chisq.test(Genh_HD)
chi_1
HD_Eth=table(heart$GeneralHealth,heart$Ethnicity)
chi_2=chisq.test(HD_Eth)
chi_2
```


```{r}
library(aod)
library(ggplot2)
summary(heart)
mylogit <- glm(HD ~ GeneralHealth+PhysicalActivity , data = heart, family = "binomial")
summary(mylogit)
confint(mylogit)
confint.default(mylogit)
wald.test(b = coef(mylogit), Sigma = vcov(mylogit), Terms = 1:2)
exp(coef(mylogit))
exp(cbind(OR = coef(mylogit), confint(mylogit)))
newdata1 <- with(heart, data.frame(GeneralHealth = mean(GeneralHealth), PhysicalActivity = mean(PhysicalActivity), rank = factor(1:2)))
newdata1$rankP <- predict(mylogit, newdata = newdata1, type = "response")
```

```{r}
library(aod)
library(ggplot2)
summary(heart)
mylogit <- glm(HD ~ SkinCancer+KidneyDisease+Asthma+Diabetic , data = heart, family = "binomial")
summary(mylogit)
confint(mylogit)
confint.default(mylogit)
```


```{r}
loadPkg("rpart") # Classification trees, rpart(formula, data=, method=,control=) 
```

```{r, echo = T, fig.dim=c(6,4)}
set.seed(1)
HDfit <- rpart(HD  ~ GeneralHealth+PhysicalActivity, data=heart, method="class", control = list(maxdepth = 4) )
# kyphosisfit <- rpart(Kyphosis ~ Age + Number + Start, data=kyphosis, method="class", control = {rpart.control list} )
# rpart.control(maxdepth = 30, minsplit = 20, minbucket = round(minsplit/3), cp = 0.01, maxcompete = 4, maxsurrogate = 5, usesurrogate = 2, xval = 10, surrogatestyle = 0, ...)
printcp(HDfit) # display the results 
plotcp(HDfit) # visualize cross-validation results 
summary(HDfit) # detailed summary of splits
plot(HDfit, uniform=TRUE, main="Classification Tree for Kyphosis")
text(HDfit, use.n=TRUE, all=TRUE, cex=.8)

```
