# Libraries 

library (tidyverse)
library (dplyr)
library (funModeling)
library(ezids)
library (ggplot2)
library(ggcorrplot)
library(corrr)


# Load the Data and Rename dataframe 
```{r}
read.csv("heart_2020_cleaned.csv")

# Renaming data frame 
heart <- rename (heart_2020_cleaned)

```
# Lets take a look at our data
```{r}
nrow (heart)
```


# Descrpitive Statistics  
```{r}
status (heart)
```

From the table we can see that Physical and Mental health have a higher percentage of zeros. This means that just over 70% of the people in our data set are not physically active while about 60% of the respondents do not report having mental health issues. 

We can also see that there are no N/A values in our data set. This is not surprising because our source data was cleaned before. 

# Now to see which variables are categorical and which are numerical 
```{r}
data_integrity(heart)
```
# Description of every variable 
```{r}
describe (heart)
```
# Finding the mean of numerical variables grouped by heart disease
```{r}
plot_num(heart)

heart %>%
  group_by(HeartDisease) %>%
  summarise_at(vars("BMI", 
                    "PhysicalHealth", 
                    "MentalHealth",
                    "SleepTime"), mean)
```
On average, people with heart disease have a slightly higher BMI than those who don't have heart disease. However, the biggest difference is the number of days that a respondent feels physically unwell. HD people reported feeling physically unwell about 8 days per month, while healthy people felt unwell for only 3.

# Frequency distributions of all our categorical variables 
```{r}
freq(heart)
```


# Changing Diabetes bordeline and pregnancy categories to Yes/No
```{r}
heart$Diabetic<- replace (heart$Diabetic, heart$Diabetic== "No, borderline diabetes" , "Yes")
heart$Diabetic[heart$Diabetic== "Yes (during pregnancy)"] <- "No"  
```


#Checking if diabetic has been changed 
```{r}
describe (heart$Diabetic)
freq(heart$Diabetic)
```

# Changing all the categorical variables to numerical dummies 
```{r}
heart$HeartDisease<-ifelse(heart$HeartDisease=="Yes",1,0)
heart$Smoking<-ifelse(heart$Smoking=="Yes",1,0)
heart$AlcoholDrinking<-ifelse(heart$AlcoholDrinking=="Yes",1,0)
heart$Stroke<-ifelse(heart$Stroke=="Yes",1,0)
heart$DiffWalking<-ifelse(heart$DiffWalking=="Yes",1,0)
heart$PhysicalActivity<-ifelse(heart$PhysicalActivity=="Yes",1,0)
heart$KidneyDisease<-ifelse(heart$KidneyDisease=="Yes",1,0)
heart$SkinCancer<-ifelse(heart$SkinCancer=="Yes",1,0)
heart$Diabetic<-ifelse(heart$Diabetic=="Yes",1,0)
heart$Asthma<-ifelse(heart$Asthma=="Yes",1,0)
```

#Correlation Plots of all variables
```{r}
 model.matrix(~0+., data=heart) %>% 
     cor(use="pairwise.complete.obs") %>% 
   ggcorrplot(show.diag = F, type="upper", lab=TRUE, lab_size=2)
```

Need bigger screen to see this corrplot properly 

## Which gender is more likely to get heart disease? 

# Contingency Table for Sex & Heart Disease 

```{r}

contable = table(heart$HeartDisease, heart$Sex)
xkabledply(contable, title="Contingency Table for Heart Disease and Sex")
addmargins(contable)

prop <-prop.table(contable)
percent <- round(prop*100, 2)

print ("Contingency Table for Heart Disease and Sex in Percentage")
print (percent)
barplot(with(heart, table(HeartDisease, Sex)), main="Heart Disease & Sex", beside=T, col=3:2)
```

Green (No HD): more women
Red (HD): More men
More men tend to have heart disease than women (Look at percentage chart)

# Subset Male & Female 
```{r}
female <- subset(heart, Sex== "Female")
male  <- subset (heart, Sex == "Male")
```

# Male Heart Disease Boxplot 
```{r}

ggplot(male, aes(x=HeartDisease, y=BMI)) + 
    geom_boxplot() +
    facet_wrap(~HeartDisease, scale="free") + 
    ggtitle("Male Heart Disease by BMI")
```   
# Female Heart Disease by BMI 

```{r}
ggplot(female, aes(x=HeartDisease, y=BMI)) + 
    geom_boxplot() +
    facet_wrap(~HeartDisease, scale="free") +
    ggtitle("Female Heart Disease by BMI")

```



# Are there differences between the means of the sexes 

```{r}

t.test(female$BMI, male$BMI)
```
The p-value is less than 0.05% significance level, allowing us to reject the null hypothesis and conclude that the overall average BMI is different between the male and female populations. 

# Is there a difference between the sex with heart disease 

```{r}
female_HD<- subset(female, HeartDisease==1)
male_HD<- subset(male, HeartDisease== 1)

t.test(female_HD$BMI, 
       male_HD$BMI)
```

We see that there is no difference in average BMI between the men and women who do have heart disease. 

# Heart Disease & Secondary Illnesses 

# Correlation matrix among diseases 

```{r}
diseases <- data.frame (heart$HeartDisease,
                        heart$Stroke,
                        heart$Diabetic,
                        heart$Asthma, 
                        heart$KidneyDisease,
                        heart$SkinCancer)

# Rename columns

names(diseases) <- c ('heart_disease',
                      'stroke',
                      'diabetic',
                      'asthma',
                      'kidney_disease',
                      'skin_cancer')


```

# Corellation  Matrix between diseases
```{r}
model.matrix(~0+., data=diseases) %>% 
     cor(use="pairwise.complete.obs") %>% 
    ggcorrplot(show.diag = F, type="upper", lab=TRUE, lab_size=2)

```

Correlations not particularly strong 
Heart disease and stroke seem correlated
Diabetes is correlated with heart disease and Kidney disease. Less with Stroke.
Skin cancer is not correlated with other  diseases.

# Determining Independence between Diseases
```{r}
hea_as=table(heart$HeartDisease,heart$Asthma)
chi_1=chisq.test(hea_as)
chi_1

hea_dia=table(heart$HeartDisease,heart$Diabetic)
chi_2=chisq.test(hea_dia)
chi_2

hea_kid=table(heart$HeartDisease,heart$KidneyDisease)
chi_3=chisq.test(hea_kid)
chi_3

hea_skin=table(heart$HeartDisease,heart$SkinCancer)
chi_4=chisq.test(hea_skin)
chi_4

hea_stroke=table(heart$HeartDisease,heart$Stroke)
chi_5=chisq.test(hea_stroke)
chi_5
```

For all the chi^2 tests we performed above, the p-value<0.05. So all the above rejects null hypothesis. 
Every secondary illness (Diabetic,Asthma, Kidney disease and skin cancer) has a relationship with Heart Disease. 


# Smokers Vs Drinkers 

```{r ctable}

contable1 = table(heart$HeartDisease, heart$AlcoholDrinking)
contable1 # the contingency table
contable2 = table(heart$HeartDisease, heart$Smoking)
contable2 # the contingency table
loadPkg("printr")
```

```{r}
contable_smoke = table(heart_2020_cleaned$HeartDisease, heart_2020_cleaned$Smoking)

prop <-prop.table(contable_smoke)
percent <- round(prop*100, 2)

xkabledply(percent, title="Contingency Table for Heart Disease and Smoking in Percentage")
```

```{r}

contable_drink = table(heart_2020_cleaned$HeartDisease, heart_2020_cleaned$AlcoholDrinking)

prop <-prop.table(contable_drink)
percent <- round(prop*100, 2)

xkabledply(percent, title="Contingency Table for Heart Disease and Drinking in Percentage")

```

```{r chisq}

chisq.test(contable_smoke)

chisq.test(contable_drink)

```
```
For both the chi^2 tests we performed above, the p-value<0.05. So all the above rejects null hypothesis. 
Both drinking and smoking have a relationship with Heart Disease. 