---
title: "Key Risk Factors of Heart Disease in 2020"
author: "Team One"
date: April 4, 2022
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## R Markdown

# Lets load the appropriate libraries 

```{r}
library(tidyverse)
library(dplyr)
library(funModeling)
library(ezids)
library(ggplot2)
library(ggcorrplot)
library(corrr)
library(corrplot)
```


# Load the Data 
```{r}

heart <-read.csv("heart_2020_cleaned.csv")
nrow (heart)
```

# Descrpitive Statistics  
```{r}
status (heart)
```

From the table we can see that Physical and Mental health have a higher percentage of zeros. This means that just over 70% of the people in our data set are not physically active while about 60% of the respondents do not report having mental health issues. 

We can also see that there are no N/A values in our data set. This is not surprising given that our data was cleaned before being retrieved.  

# Description of every variable 
```{r error= TRUE}
describe (heart)
```

# Finding the mean of numerical variables grouped by heart disease
```{r }
plot_num(heart)

heart %>%
  group_by(HeartDisease) %>%
  summarise_at(vars("BMI", 
                    "PhysicalHealth", 
                    "MentalHealth",
                    "SleepTime"), mean)
```
On average, people with heart disease have a slightly higher BMI than those who don't have heart disease. However, the biggest difference is the number of days that a respondent feels physically unwell. Respondents who have heart disease reported feeling physically unwell about 8 days per month, while healthy people felt unwell for only 3. Poor mental health in a 30 day period is slightly higher for people with heart diesease, than for people without. 

# Frequency distributions of all our categorical variables 
```{r}
freq(heart)
```


# Changing Diabetes bordeline and pregnancy categories to Yes/No
```{r}
heart$Diabetic<- replace (heart$Diabetic, heart$Diabetic== "No, borderline diabetes" , "Yes")
heart$Diabetic[heart$Diabetic== "Yes (during pregnancy)"] <- "No"  
```


#Checking if diabetic has been changed 
```{r}
describe (heart$Diabetic)
freq(heart$Diabetic)
```

# Changing all the categorical variables to numerical dummies 
```{r}
heart$HeartDisease<-ifelse(heart$HeartDisease=="Yes",1,0)
heart$Smoking<-ifelse(heart$Smoking=="Yes",1,0)
heart$AlcoholDrinking<-ifelse(heart$AlcoholDrinking=="Yes",1,0)
heart$Stroke<-ifelse(heart$Stroke=="Yes",1,0)
heart$DiffWalking<-ifelse(heart$DiffWalking=="Yes",1,0)
heart$PhysicalActivity<-ifelse(heart$PhysicalActivity=="Yes",1,0)
heart$KidneyDisease<-ifelse(heart$KidneyDisease=="Yes",1,0)
heart$SkinCancer<-ifelse(heart$SkinCancer=="Yes",1,0)
heart$Diabetic<-ifelse(heart$Diabetic=="Yes",1,0)
heart$Asthma<-ifelse(heart$Asthma=="Yes",1,0)
```

#Correlation Plots of all variables
```{r}
 model.matrix(~0+., data=heart) %>% 
     cor(use="pairwise.complete.obs") %>% 
   ggcorrplot(show.diag = F, type="upper", lab=TRUE, lab_size=2)
```


## Gender and Lifestyle

# Contingency Table for Sex & Heart Disease 

```{r}

contable = table(heart$heartDisease, heart$Sex)
xkabledply(contable, title="Contingency Table for heart Disease and Sex")
addmargins(contable)

prop <-prop.table(contable)
percent <- round(prop*100, 2)

print ("Contingency Table for heart Disease and Sex in Percentage")
print (percent)
barplot(with(heart, table(heartDisease, Sex)), main="heart Disease & Sex", beside=T, col=3:2)
```

Looking at the plot, we can see that we have a lot more data for people without heart disease than with. However, even in the percentage table for those who do have heart disease, we see that there are more men with heart disease (about 5%) compared to women (3%). 

Why do men have more HD than women? Are the men in our study doing more or less of something? 


First lets look at BMI 

# Are there differences between the mean BMI of the sexes?

```{r}
# Subset Male & Female with and without Heart Disease
female <- subset(heart, Sex== "Female")
male  <- subset (heart, Sex == "Male")

# T-test of BMI between Genders 
t.test(female$BMI, male$BMI)
```

The p-value is less than 0.05% significance level, allowing us to reject the null hypothesis and conclude that the overall average BMI is different between the male and female populations. However, we still don't know which population has the higher BMI.  

# Is there a difference in average BMI between the sexes with heart disease 

```{r}
# Subsetting genders based on respondents that have heart disease 
HD <- subset(heart, HeartDisease==1)
female_HD<- subset(female, HeartDisease==1)
male_HD<- subset(male, HeartDisease== 1)

# Checking normality of data. Skewed but approxiamately normal  
qqnorm(female_HD$BMI)
qqline(female_HD$BMI)

qqnorm(male_HD$BMI)
qqline(male_HD$BMI)


#T-Test
t.test(female_HD$BMI, male_HD$BMI)
                  
 
```

From the welches,  We see that there is no difference in average BMI between the men and women who do have heart disease. 

Most of our other varaiables in HD are zero. So can't really assess lifelstyle habits.

#Physical Health 
```{r}
par(mfrow=c(2,2))
boxplot(female_HD$PhysicalHealth)
boxplot(male_HD$PhysicalHealth)

qqnorm(female_HD$PhysicalHealth)
qqline(female_HD$PhysicalHealth)

qqnorm(male_HD$PhysicalHealth)
qqline(male_HD$PhysicalHealth)

t.test(male_HD$PhysicalHealth, 
       female_HD$PhysicalHealth)
```
#Mental Health 
```{r}
t.test  (male_HD$MentalHealth, 
       female_HD$MentalHealth)
```

# Sleep
```{r}
t.test  (male_HD$SleepTime, 
       female_HD$SleepTime)
```

# Age, Race, Gen Health
```{r}
freq(HD$AgeCategory)
freq(HD$Race)
freq(HD$GenHealth)

```

# Liner Regression on Sex 
```{r}
reg_1 <- lm(HeartDisease~Sex+BMI+ PhysicalHealth+MentalHealth, data=heart)
summary (reg_1)

reg_2 <- lm(HeartDisease~Sex+BMI+ PhysicalHealth+MentalHealth + SleepTime, data=heart)
summary (reg_2)

reg_3 <- lm(HeartDisease~Sex+BMI+ PhysicalHealth+MentalHealth + SleepTime +AgeCategory + Race, data=heart)
summary (reg_3)
```

Adjusted r-square is increasing so definitely model fit is improving but still not a good fit 

# Heart Disease & Secondary Illnesses 

# Correlation matrix among diseases 

```{r}
diseases <- data.frame (heart$heartDisease,
                        heart$Stroke,
                        heart$Diabetic,
                        heart$Asthma, 
                        heart$KidneyDisease,
                        heart$SkinCancer)

# Rename columns

names(diseases) <- c ('heart_disease',
                      'stroke',
                      'diabetic',
                      'asthma',
                      'kidney_disease',
                      'skin_cancer')


```

# Corellation  Matrix between diseases
```{r}
model.matrix(~0+., data=diseases) %>% 
     cor(use="pairwise.complete.obs") %>% 
    ggcorrplot(show.diag = F, type="upper", lab=TRUE, lab_size=2)

```

Correlations not particularly strong 
heart disease and stroke seem correlated
Diabetes is correlated with heart disease and Kidney disease. Less with Stroke.
Skin cancer is not correlated with other  diseases.

# Determining Independence between Diseases
```{r}
hea_as=table(heart$heartDisease,heart$Asthma)
chi_1=chisq.test(hea_as)
chi_1

hea_dia=table(heart$heartDisease,heart$Diabetic)
chi_2=chisq.test(hea_dia)
chi_2

hea_kid=table(heart$heartDisease,heart$KidneyDisease)
chi_3=chisq.test(hea_kid)
chi_3

hea_skin=table(heart$heartDisease,heart$SkinCancer)
chi_4=chisq.test(hea_skin)
chi_4

hea_stroke=table(heart$heartDisease,heart$Stroke)
chi_5=chisq.test(hea_stroke)
chi_5
```

For all the chi^2 tests we performed above, the p-value<0.05. So all the above rejects null hypothesis. 
Every secondary illness (Diabetic,Asthma, Kidney disease and skin cancer) has a relationship with heart Disease. 


# Smokers Vs Drinkers 


```{r}
contable_smoke = table(heart_2020_cleaned$heartDisease, heart_2020_cleaned$Smoking)

prop <-prop.table(contable_smoke)
percent <- round(prop*100, 2)

xkabledply(percent, title="Contingency Table for heart Disease and Smoking in Percentage")
```

```{r}

contable_drink = table(heart_2020_cleaned$heartDisease, heart_2020_cleaned$AlcoholDrinking)

prop <-prop.table(contable_drink)
percent <- round(prop*100, 2)

xkabledply(percent, title="Contingency Table for heart Disease and Drinking in Percentage")

```

```{r chisq}

chisq.test(contable_smoke)

chisq.test(contable_drink)

```
```
For both the chi^2 tests we performed above, the p-value<0.05. So all the above rejects null hypothesis. 
Both drinking and smoking have a relationship with heart Disease. 